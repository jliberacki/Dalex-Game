package model.gameobjects;

import model.Coordinates;
import model.DalekGraph;
import model.Field;

import java.util.LinkedList;
import java.util.stream.Collectors;

public class DestroyerDalek extends Dalek {

    private LinkedList<Field> powerupFields;
    public DalekGraph destroyerGraph;

    @Override
    public void move() {

        powerupFields = powerupFields.stream()
                .filter(Field::hasPowerUp)
                .sorted((x, y) -> {
                    double distanceToX = x.getCoordinates().distanceTo(this.coordinates);
                    double distanceToY = y.getCoordinates().distanceTo(this.coordinates);
                    if (distanceToX == distanceToY) return 0;
                    return (distanceToX > distanceToY) ? 1 : -1;
                })
                .collect(Collectors.toCollection(LinkedList::new));

        if (powerupFields.isEmpty()) {
            this.coordinates = graph.nextStepToTarget(this.coordinates);
        } else {
            Field target = powerupFields.getFirst();
            destroyerGraph.calculatePaths(target.getCoordinates());
            this.coordinates = destroyerGraph.nextStepToTarget(this.coordinates);
        }

    }

    public DestroyerDalek(Coordinates coordinates, DalekGraph dalekGraph, DalekGraph destroyerGraph, LinkedList<Field> powerupFields) {
        super(coordinates, dalekGraph);
        this.destroyerGraph = destroyerGraph;
        this.powerupFields = powerupFields;
    }
}
